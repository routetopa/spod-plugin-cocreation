<link rel="import" href="{$components_url}bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="{$components_url}bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="{$components_url}bower_components/paper-toast/paper-toast.html">

<link rel="import" href="{$components_url}bower_components/paper-card/paper-card.html">

<link rel="import" href="{$components_url}bower_components/iron-icons/iron-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/maps-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/communication-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/image-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/av-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/social-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/editor-icons.html">

<link rel="import" href="{$components_url}bower_components/paper-button/paper-button.html">
<link rel="import" href="{$components_url}bower_components/paper-checkbox/paper-checkbox.html">

<link rel="import" href="{$components_url}datalets/leafletjs-datalet/leafletjs-datalet.html">

<link rel="import" href="{$components_url}bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-fab/paper-fab.html">
<link rel="import" href="{$components_url}bower_components/paper-fab-transitions/paper-fab-speed-dial.html">
<link rel="import" href="{$components_url}bower_components/paper-menu/paper-menu.html">
<link rel="import" href="{$components_url}bower_components/paper-item/paper-item.html">

<link rel="import" href="{$components_url}controllets/paper-card-controllet/paper-card-controllet.html"/>
<link rel="import" href="{$components_url}controllets/search-panel-controllet/search-panel-controllet.html"/>
<link rel="import" href="{$components_url}controllets/animated-grid-controllet/animated-grid-controllet.html"/>
<link rel="import" href="{$components_url}controllets/fullsize-page-with-card-controllet/fullsize-page-with-card-controllet.html">
<link rel="import" href="{$components_url}controllets/text-element-controllet/metadata-element-controllet.html"/>
<link rel="import" href="{$components_url}controllets/info-list-controllet/info-list-controllet.html"/>

<link rel="import" href="{$components_url}bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="{$components_url}bower_components/paper-styles/color.html">


<link rel="import" href="{$components_url}bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="{$components_url}bower_components/paper-styles/paper-styles.html">
<link rel="import" href="{$components_url}bower_components/neon-animation/neon-animations.html">

<link rel="import" href="{$components_url}bower_components/polymer-element-catalog/app/elements/app-sidebar/app-sidebar.html">
<link rel="import" href="{$components_url}controllets/datalet-slider-controllet/datalet-slider-controllet.html"/>
<link rel="import" href="{$components_url}controllets/metadata-list-controllet/metadata-list-controllet.html"/>

<!-- DATALET -->
<link rel="import" href="{$components_url}datalets/areachart-datalet/areachart-datalet.html">
<link rel="import" href="{$components_url}datalets/barchart-datalet/barchart-datalet.html">
<link rel="import" href="{$components_url}datalets/bubblechart-datalet/bubblechart-datalet.html">
<link rel="import" href="{$components_url}datalets/columnchart-datalet/columnchart-datalet.html">
<link rel="import" href="{$components_url}datalets/datatable-datalet/datatable-datalet.html">
<link rel="import" href="{$components_url}datalets/leafletjs-datalet/leafletjs-datalet.html">
<link rel="import" href="{$components_url}datalets/leafletjs-geojson-datalet/leafletjs-geojson-datalet.html">
<link rel="import" href="{$components_url}datalets/linechart-datalet/linechart-datalet.html">
<link rel="import" href="{$components_url}datalets/heatmap-datalet/heatmap-datalet.html">
<link rel="import" href="{$components_url}datalets/piechart-datalet/piechart-datalet.html">
<link rel="import" href="{$components_url}datalets/scatterchart-datalet/scatterchart-datalet.html">
<link rel="import" href="{$components_url}datalets/treemap-datalet/treemap-datalet.html">


<script src="{$components_url}locales/controllet_ln.js" type="text/javascript"></script>
<script src="{$components_url}locales/paper_card_controllet_ln.js" type="text/javascript"></script>
<script src="{$components_url}locales/datalet-slider_ln.js" type="text/javascript"></script>
<script src="{$components_url}locales/metadata_list_ln.js" type="text/javascript"></script>
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>

<style is="custom-style">
    .separator
    {
        height: 1px;
        background: #ddd;
        margin: 12px 8px;
    }

    paper-item
    {
        cursor: pointer;
    }

    paper-drawer-panel {
        --paper-drawer-panel-left-drawer-container: {
            top: 56px;
            z-index: 1;
        };
    }

    paper-toolbar
    {
        --paper-toolbar-height: 56px;
        --paper-toolbar-background: #4CAF50;
    }

    #paperDrawerPanel
    {
        top: 60px;
    }

    iron-icon
    {
        --iron-icon-height : 32px;
        --iron-icon-width : 32px;
        /*--iron-icon-fill-color: #9E9E9E;*/
    }


    iron-icon#dataset_icon
    {
        --iron-icon-fill-color: #4CAF50;
    }

    iron-icon#metadata_icon
    {
        --iron-icon-fill-color: #FF5722;
    }

    iron-icon[icon="description"]
    {
        --iron-icon-fill-color: #2196F3;
    }

    iron-icon#discussion_icon
    {
    }

    iron-icon[icon="assessment"]
    {
    }

    iron-icon#screen_1
    {
        --iron-icon-height : 24px;
        --iron-icon-width : 24px;
        -o-transform: rotate(-90deg);
        -webkit-transform: rotate(-90deg);
        -moz-transform: rotate(-90deg);

        --iron-icon-fill-color: #00BCD4;
    }

    iron-icon#screen_2
    {
        --iron-icon-height : 24px;
        --iron-icon-width : 24px;
        -o-transform: rotate(90deg);
        -webkit-transform: rotate(90deg);
        -moz-transform: rotate(90deg);

        --iron-icon-fill-color: #00BCD4;
    }

    paper-item-body
    {
        padding-left: 24px;
    }

    paper-item-body.no_padding_item
    {
        padding-left: 8px;
    }

    paper-checkbox.checkbox_splitscreen
    {
        position: absolute;
        right: 32px;
        top: 15px;
        --paper-checkbox-checked-color: #4CAF50;
    }

    paper-fab
    {
        --paper-fab-background : #00BCD4;
        --paper-fab: {
            height: 40px;
            width: 40px;
            padding: 0;
            margin: 8px;
        };
    }

    .header_container
    {
        width: 100%;
    }

    .hader_title_container
    {
        float:left;
        max-width: calc(50% - 32px);
        height: 56px;
        overflow: hidden;
        /*background: red;*/
        /*max-width: calc(50% - 64px);*/
        overflow: hidden;
    }

    .header_title
    {
        line-height: 56px;
        font-size: 18px;

        max-width: 448px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;

        float: left;
    }

    .right_floater
    {
        float: right;
        height: 56px;
        overflow-y: auto;
        max-width: calc(50% - 32px);
        /*background: red;*/

    }

    #right_floater::-webkit-scrollbar-track
    {
        background-color: #00BCD4;
    }

    #right_floater::-webkit-scrollbar
    {
        width: 8px;
        height: 8px;
    }

    #right_floater::-webkit-scrollbar-thumb
    {
        border-radius: 8px;
        background-color:  #FFFFFF;
    }

    .hader_title_container > paper-button
    {
        --paper-button:{
            background: #00BCD4;
            height: 40px;
            margin: 8px 0 8px 24px;
        }
    }

    .content_container
    {
        height: calc(100vh - 158px);
    }

    .full_size_content
    {
        position: relative;

        height: 100%;
        width: 100%;
    }

    .screen_header {
        height: 24px;
        width: calc(100% - 24px);
        padding: 12px;
        background-color: #B6B6B6;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        /*in all*/
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 16px;
        line-height: 24px;
    }

    .screen_hidden_header {
        height: 24px;
        width: calc(100% - 292px);
        padding: 12px 146px 12px 0;
        background-color: transparent;
        color: #FFFFFF;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        position: absolute;
        top: 0;
        right: 0;
        /*in all*/
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 16px;
        line-height: 24px;
    }

    /*#discussion .screen_header {*/
    /*}*/

    #notes .screen_header {
        background-color: #2196F3;
        color: #FFFFFF;
    }

    #notes {
        overflow: hidden;
    }

    paper-toast {
        opacity: 0.8;
        background: #000000;
    }

    #syncToast br {
        display: block;
        margin-top: 8px;
        content: " ";
    }

    #syncToast p {
        margin: 0;
        padding: 0;

        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 16px;
        line-height: 24px;
    }

    #syncToast p .title{
        font-size: 24px;
        color: #2196F3;
        padding-right: 56px;
    }

    #card_container p .description{
    }

    paper-icon-button.clear {
        /*width: 24px;*/
        /*height: 24px;*/
        /*padding: 0px 4px;*/
        position: absolute;
        top: 0;
        right: 0;
        color: #F44336;
        --paper-icon-button-ink-color: #FFFFFF;
    }

    /*gg style*/
    #dialog_info {
        border: 2px solid #2196F3;
        background-color: #E0E0E0;
        height: 80vh;
        width: 80vh;
        padding: 20px;
        overflow: auto;
    }

    #dialog_content{
        position: relative;
    }

    #overlay{
        z-index: 1;
        position:absolute;
        top:0;
        left:0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    #saveMetadataButton{
        background: #2196F3;
        color: #ffffff;
        position: absolute;
        float: right;
        right: 25px;
        bottom: 15px;
        z-index: 10;
    }

    .full_size_card{
        position: absolute;
        top: 0;
        left: 0;

        margin:32px 32px 32px 32px;
        height: calc(100% - 64px);
        width: calc(100% - 64px);
        display:block;
    }
    
    .split_size_card_left{
        margin:32px 16px 32px 32px;
        height: calc(100% - 64px);
        width: calc(50% - 48px);
        /*float:left;*/
        right: inherit;
        left: 0px;
    }
    
    .split_size_card_right{
        left: inherit;
        right: 0px;
        /*float: right;*/
        margin:32px 32px 32px 16px;
        height: calc(100% - 64px);
        width: calc(50% - 48px);
    }

    /*end gg style*/

    div.owner_badge {
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 12px;
        line-height: 18px;
        font-weight: 700;
        color: white;
        background-color: #00BCD4;
        /*opacity: 0.9;*/
        position: absolute;
        bottom: 4px;
        right: 0;
        height: 16px;
        width: 56px;
        text-align: center;
    }


</style>
<template id="data_room" is="dom-bind">
    {if $isMember == false}
    <div id="overlay">
        <h1 style="position: relative; top: 25%; left: 10%;">{text key="cocreation+concreation_not_member"}</h1>
    </div>
    {/if}
    {if $isMember == true}
    <div style="height: 100%;">

        <paper-drawer-panel id="paperDrawerPanel" force-narrow>

            <paper-header-panel drawer>
                <div>
                    <paper-menu id="section_menu">

                        <paper-item id="dataset_menu_item" onclick="room.handleSelectUIMode('dataset')">
                            <iron-icon id="dataset_icon" icon="image:grid-on"></iron-icon>
                            <paper-item-body two-lines title='{text key="cocreation+room_dataset_tooltip"}'>
                                <div>{text key="cocreation+room_dataset_tab_label"}</div>
                            </paper-item-body>
                        </paper-item>

                        <paper-item id="metadata_menu_item" onclick="room.handleSelectUIMode('metadata')">
                            <iron-icon id="metadata_icon" icon="maps:local-offer"></iron-icon>
                            <paper-item-body two-lines title='{text key="cocreation+room_metadata_tooltip"}'>
                                <div>{text key="cocreation+room_metadata_tab_label"}</div>
                            </paper-item-body>
                        </paper-item>

                        <paper-item onclick="room.handleSelectUIMode('notes')">
                            <iron-icon icon="description"></iron-icon>
                            <paper-item-body two-lines title='{text key="cocreation+room_notes_tooltip"}'>
                                <div>{text key="cocreation+room_notes_tab_label"}</div>
                            </paper-item-body>
                        </paper-item>

                        <div class="separator"></div>

                        <paper-item onclick="room.handleSelectUIMode('discussion')">
                            <iron-icon id="discussion_icon" icon="communication:forum"></iron-icon>
                            <paper-item-body two-lines title='{text key="cocreation+room_discussion_tab_label"}'>
                                <div>{text key="cocreation+room_discussion_tab_label"}</div>
                            </paper-item-body>
                        </paper-item>

                        <paper-item onclick="room.handleSelectUIMode('datalets')">
                            <iron-icon icon="assessment"></iron-icon>
                            <paper-item-body two-lines title='{text key="cocreation+room_cc_datalet"}'>
                                <div>Datalets</div>
                            </paper-item-body>
                        </paper-item>


                        <paper-item id="info_menu_item" onclick="room.handleSelectUIMode('info')">
                            <iron-icon icon="info"></iron-icon>
                            <paper-item-body two-lines>
                                <div>Info</div>
                            </paper-item-body>
                        </paper-item>

                        <div class="separator"></div>

                    </paper-menu>

                    <paper-item onclick="room.handleSelectUIMode('split')">
                        <iron-icon id="screen_1" icon="av:airplay"></iron-icon>
                        <iron-icon id="screen_2" icon="av:airplay"></iron-icon>
                        <paper-item-body class="no_padding_item" two-lines>
                            <div>
                                <span style="font-weight: 700">Split screen</span>
                                <paper-checkbox id="split_checkbox" class="checkbox_splitscreen" onclick="room.handleSelectUIMode('split')"></paper-checkbox>
                            </div>
                        </paper-item-body>
                    </paper-item>

                </div>

            </paper-header-panel>

            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <div class="header_container">

                        <div class="hader_title_container">
                            <div class="header_title" title="{$room->name}">{$room->name}</div>
                            <paper-button raised title='{text key="cocreation+room_publish_dataset_tooltip"}' on-tap="_publishDataset">{text key="cocreation+publish_dataset_button_label"}</paper-button>
                        </div>

                        <div style="float: right">
                            {if $ownerUserActive}
                               <paper-fab icon="add" onclick="room.inviteNewUsers();" title='{text key="cocreation+room_invite_new_members_button"}'></paper-fab>
                            {/if}
                        </div>

                        <div id="right_floater" class="right_floater">
                            <div class="ow_avatar style-scope" title="{$owner['title']}"><div class="owner_badge">OWNER</div><a class="style-scope" href="{$owner['url']}"><img alt="" style="max-width: 100%;" class="style-scope dataset-table-controllet" src="{$owner['src']}"></a></div>
                            {foreach $members as $member}
                                {if $member['isJoined']}
                                    <div class="ow_avatar style-scope" title="{$member['title']}"><a class="style-scope" href="{$member['url']}"><img alt="" style="max-width: 100%;" class="style-scope dataset-table-controllet" src="{$member['src']}"></a></div>
                                {/if}
                            {/foreach}
                        </div>

                    </div>
                </paper-toolbar>

                <!-- FULL SIZE ETHERSHEET -->
                <div class="content_container">
                    <div id="full_size_container" class="full_size_content">
                         <!-- Dataset -->
                        <paper-card id="spreadsheet" class="full_size_card" style="visibility:visible;" elevation="5">
                            <div class="screen_hidden_header">{text key="cocreation+room_dataset_tab_label"}</div>
                            <iframe id="spreadsheet_container" src="{$spreadsheet}" style="height: 100%; width: 100%;"></iframe>
                        </paper-card>
                        <!-- Metadata -->
                        <paper-card id="metadata" class="full_size_card" style="visibility:hidden;" elevation="5">
                            <metadata-list-controllet id="metadata_component"></metadata-list-controllet>
                        </paper-card>
                        <!-- Notes -->
                        <paper-card id="notes" class="full_size_card" style="visibility:hidden;" elevation="5">
                            <div class="screen_header">{text key="cocreation+room_notes_tab_label"}</div>
                            <iframe src="{{$notes}}?userName={{$currentUser['title']}}&showControls=true&showLineNumbers=false&pageview=true" style="height: 100%; width: 100%;"></iframe>
                        </paper-card>
                        <!-- Discussion -->
                        <paper-card id="discussion" class="full_size_card" style="visibility:hidden;" elevation="5">
                            <div class="screen_header">{text key="cocreation+room_discussion_tab_label"}</div>
                            <div id="discussion_container" style="overflow-y: scroll;overflow-x: hidden;height: calc(100% - 45px)">
                                {$comments}
                            </div>
                        </paper-card>
                        <!-- Datalets -->
                        <paper-card id="datalets" class="full_size_card" style="display:none;" elevation="5">
                            <datalet-slider-controllet id="datalets_slider"></datalet-slider-controllet>
                        </paper-card>
                        <!-- Info -->
                        <paper-card id="info" class="full_size_card" style="visibility:hidden;" elevation="5">
                            <info-list-controllet id="info_list_controllet"></info-list-controllet>
                        </paper-card>
                    </div>
                </div>
            </paper-header-panel>

        </paper-drawer-panel>

    </div>

    <paper-toast id="syncToast" duration="0">
        <p>
            <span class="title">{text key="cocreation+room_sync_toast"}</span>
            <br>
            <span class="description" id="syncMessage">Le stanze dell'Agora sono pubbliche. Le discussioni saranno visibili anche all'esterno di SPOD.</span>
        </p>
        <paper-icon-button class="clear" suffix onclick="syncToast.toggle()" icon="clear"></paper-icon-button>
    </paper-toast>

</template>
{/if}